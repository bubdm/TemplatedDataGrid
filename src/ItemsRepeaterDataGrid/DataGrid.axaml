<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:c="using:ItemsRepeaterDataGrid">
  <Design.PreviewWith>
    <c:DataGrid/>
  </Design.PreviewWith>
  <Style Selector="c|DataGrid">
    <Setter Property="Template">
      <ControlTemplate>
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="1"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="{Binding Columns[0].Width, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Static GridLength.Auto}}"/>
            <ColumnDefinition Width="1"/>
            <ColumnDefinition Width="{Binding Columns[1].Width, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Static GridLength.Auto}}"/>
            <ColumnDefinition Width="1"/>
            <ColumnDefinition Width="{Binding Columns[2].Width, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Static GridLength.Auto}}"/>
          </Grid.ColumnDefinitions>
          <!-- Header -->
          <Grid Grid.Row="0"  Grid.Column="0" Grid.ColumnSpan="5">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="{Binding Columns[0].Width, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Static GridLength.Auto}}"/>
              <ColumnDefinition Width="1"/>
              <ColumnDefinition Width="{Binding Columns[1].Width, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Static GridLength.Auto}}"/>
              <ColumnDefinition Width="1"/>
              <ColumnDefinition Width="{Binding Columns[2].Width, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Static GridLength.Auto}}"/>
            </Grid.ColumnDefinitions>
            <Panel Grid.Column="0" Margin="6" Background="Transparent">
              <ContentControl Content="{Binding Columns[0].Header, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Null}}" />
            </Panel>
            <Panel Grid.Column="2" Margin="6" Background="Transparent">
              <ContentControl Content="{Binding Columns[1].Header, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Null}}" /> 
            </Panel>
            <Panel Grid.Column="4" Margin="6" Background="Transparent">
              <ContentControl Content="{Binding Columns[2].Header, RelativeSource={RelativeSource TemplatedParent}, FallbackValue={x:Null}}" />
            </Panel>
          </Grid>
          <!-- Rows -->
          <ScrollViewer Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="5" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
            <ItemsRepeater Items="{TemplateBinding Items}">
              <ItemsRepeater.Layout>
                <StackLayout Orientation="Vertical"/>
              </ItemsRepeater.Layout>
              <ItemsRepeater.ItemTemplate>
                <DataTemplate>
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="{Binding Columns[0].Width, Mode=OneWay, RelativeSource={RelativeSource AncestorType={x:Type c:DataGrid}}, FallbackValue={x:Static GridLength.Auto}}"/>
                      <ColumnDefinition Width="1"/>
                      <ColumnDefinition Width="{Binding Columns[1].Width, Mode=OneWay, RelativeSource={RelativeSource AncestorType={x:Type c:DataGrid}}, FallbackValue={x:Static GridLength.Auto}}"/>
                      <ColumnDefinition Width="1"/>
                      <ColumnDefinition Width="{Binding Columns[2].Width, Mode=OneWay, RelativeSource={RelativeSource AncestorType={x:Type c:DataGrid}}, FallbackValue={x:Static GridLength.Auto}}"/>
                    </Grid.ColumnDefinitions>
                    <Grid.Styles>
                      <Style Selector="Grid">
                        <Setter Property="Background" Value="Transparent"/>
                      </Style>
                      <Style Selector="Grid:pointerover">
                        <Setter Property="Background" Value="LightGray"/>
                      </Style>
                    </Grid.Styles>
                    <Panel Grid.Column="0" Margin="6" Background="Transparent">
                      <ContentControl Content="{Binding .}"
                                      ContentTemplate="{Binding Columns[0].CellTemplate, RelativeSource={RelativeSource AncestorType={x:Type c:DataGrid}}, FallbackValue={x:Null}}"/>
                    </Panel>
                    <Panel Grid.Column="2" Margin="6" Background="Transparent">
                      <ContentControl Content="{Binding .}"
                                      ContentTemplate="{Binding Columns[1].CellTemplate, RelativeSource={RelativeSource AncestorType={x:Type c:DataGrid}}, FallbackValue={x:Null}}"/>
                    </Panel>
                    <Panel Grid.Column="4" Margin="6" Background="Transparent">
                      <ContentControl Content="{Binding .}"
                                      ContentTemplate="{Binding Columns[2].CellTemplate, RelativeSource={RelativeSource AncestorType={x:Type c:DataGrid}}, FallbackValue={x:Null}}"/>
                    </Panel>
                  </Grid>
                </DataTemplate>
              </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
          </ScrollViewer>
          <!-- Lines -->
          <Separator Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="5" Background="Gray" Height="1"/>
          <Separator Grid.Row="0" Grid.RowSpan="3" Grid.Column="1" Background="Gray" Width="1"/>
          <Separator Grid.Row="0" Grid.RowSpan="3" Grid.Column="3" Background="Gray" Width="1"/>
          <!-- Splitters -->
          <GridSplitter Grid.Row="0" Grid.RowSpan="3" Grid.Column="1" 
                        Background="Transparent" 
                        ResizeDirection="Columns"
                        IsEnabled="{TemplateBinding CanUserResizeColumns}"/>
          <GridSplitter Grid.Row="0" Grid.RowSpan="3" Grid.Column="3" 
                        Background="Transparent" 
                        ResizeDirection="Columns"
                        IsEnabled="{TemplateBinding CanUserResizeColumns}"/>
        </Grid>
      </ControlTemplate>
    </Setter>
  </Style>
</Styles>

